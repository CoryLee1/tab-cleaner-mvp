# CleanTab MVP

ä¸€ä¸ªåŸºäº Chrome æ‰©å±•çš„æ ‡ç­¾é¡µç®¡ç†å·¥å…·ï¼Œä½¿ç”¨ Shadow DOM æŠ€æœ¯å®ç°åœ†è§’å¡ç‰‡ UIã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¨ **åœ†è§’å¡ç‰‡ UI**ï¼šä½¿ç”¨ Shadow DOM æŠ€æœ¯ï¼Œçªç ´ Chrome Popup åœ†è§’é™åˆ¶
- ğŸ–±ï¸ **å¯æ‹–åŠ¨å¡ç‰‡**ï¼šç‚¹å‡»å¹¶æ‹–åŠ¨å¡ç‰‡ä¸Šæ–¹çš„æ‹–æ‹½åŒºåŸŸå¯ç§»åŠ¨å¡ç‰‡ä½ç½®
- ğŸ“ **æ™ºèƒ½å®šä½**ï¼šå¡ç‰‡é»˜è®¤å‡ºç°åœ¨æµè§ˆå™¨å³ä¸Šè§’ï¼Œæ’ä»¶å›¾æ ‡ä¸‹æ–¹
- ğŸ¯ **äº¤äº’æŒ‰é’®**ï¼šä¸‰ä¸ªåŠŸèƒ½æŒ‰é’®ï¼ˆHomeã€Cleanã€Detailsï¼‰å’Œå…³é—­æŒ‰é’®
- ğŸ–¼ï¸ **å®Œæ•´èƒŒæ™¯**ï¼šæ”¯æŒèƒŒæ™¯å›¾ç‰‡å’Œæ‰€æœ‰è£…é¥°å…ƒç´ 
- ğŸ“Š **è¯¦æƒ…æ˜¾ç¤º**ï¼šç‚¹å‡» Details æŒ‰é’®å¯æ˜¾ç¤º/éšè—æ’ä»¶çŠ¶æ€ä¿¡æ¯ï¼ˆå¼€å¯æ—¶é—´ç­‰ï¼‰
- ğŸ’¡ **Tooltip æç¤º**ï¼šæ‰€æœ‰æŒ‰é’®éƒ½æœ‰æ‚¬åœæç¤ºï¼Œæ˜¾ç¤ºåŠŸèƒ½è¯´æ˜
- ğŸµ **æ¡Œé¢å® ç‰©**ï¼šç‚¹å‡» Window Button åœ¨æµè§ˆå™¨å³ä¸‹è§’å¬å”¤æ¡Œé¢å® ç‰©ï¼Œç‚¹å‡»å® ç‰©æ˜¾ç¤ºæ“ä½œæŒ‰é’®ï¼ˆéšè—ã€è®¾ç½®ã€æ¸…ç†ç­‰ï¼‰

## ç›®å½•ç»“æ„

```
tab-cleaner-mvp/
â”œâ”€ backend/
â”‚  â””â”€ app/
â”‚     â”œâ”€ __init__.py
â”‚     â”œâ”€ api/
â”‚     â”‚  â””â”€ __init__.py
â”‚     â”œâ”€ main.py              # FastAPI åº”ç”¨å…¥å£
â”‚     â”œâ”€ pyproject.toml        # ä¾èµ–é…ç½®
â”‚     â”œâ”€ uv.lock              # ä¾èµ–é”å®šæ–‡ä»¶
â”‚     â”œâ”€ services/             # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚     â””â”€ static/               # é™æ€èµ„æº
â””â”€ frontend/
   â”œâ”€ src/
   â”‚   â”œâ”€ background/          # Service Workerï¼ˆæœªä½¿ç”¨ï¼Œå·²è¿ç§»åˆ° publicï¼‰
   â”‚   â”œâ”€ shared/              # å…±äº«é€»è¾‘ï¼ˆAPI è°ƒç”¨ç­‰ï¼‰
   â”‚   â”œâ”€ screens/             # Anima ç»„ä»¶ï¼ˆReact ç‰ˆæœ¬ï¼Œä¾›å‚è€ƒï¼‰
   â”‚   â”‚   â””â”€ Card/            # å¡ç‰‡ç»„ä»¶
   â”‚   â””â”€ icons/               # SVG å›¾æ ‡
   â”œâ”€ public/                  # é™æ€èµ„æºï¼ˆæ„å»ºæ—¶ä¼šå¤åˆ¶åˆ° dist/ï¼‰
   â”‚   â”œâ”€ assets/
   â”‚   â”‚   â”œâ”€ background.js    # Service Workerï¼šç›‘å¬å›¾æ ‡ç‚¹å‡»
   â”‚   â”‚   â”œâ”€ content.js       # Content Scriptï¼šåˆ›å»º Shadow DOM å¡ç‰‡
   â”‚   â”‚   â”œâ”€ pet.js           # å® ç‰©æ¨¡å—ï¼šç‹¬ç«‹å¤„ç†æ¡Œé¢å® ç‰©åŠŸèƒ½
   â”‚   â”‚   â”œâ”€ card.html        # å¡ç‰‡ HTML æ¨¡æ¿
   â”‚   â”‚   â”œâ”€ style.css        # å¡ç‰‡æ ·å¼
   â”‚   â”‚   â””â”€ styleguide.css   # è®¾è®¡è§„èŒƒæ ·å¼
   â”‚   â”œâ”€ static/
   â”‚   â”‚   â””â”€ img/             # å›¾ç‰‡èµ„æº
   â”‚   â”‚       â”œâ”€ background-2.png    # å¡ç‰‡èƒŒæ™¯
   â”‚   â”‚       â”œâ”€ window.png           # çª—å£è£…é¥°
   â”‚   â”‚       â”œâ”€ draggable-2.svg      # æ‹–æ‹½å›¾æ ‡
   â”‚   â”‚       â”œâ”€ home-button-2.png    # é¦–é¡µæŒ‰é’®
   â”‚   â”‚       â”œâ”€ clean-button.png     # æ¸…ç†æŒ‰é’®
   â”‚   â”‚       â”œâ”€ details-button.svg   # è¯¦æƒ…æŒ‰é’®
   â”‚   â”‚       â”œâ”€ æ´—è¡£æœºè¯¦æƒ….png        # è¯¦æƒ…æ˜¾ç¤ºå›¾ç‰‡ï¼ˆæ’ä»¶çŠ¶æ€ä¿¡æ¯ï¼‰
   â”‚   â”‚       â”œâ”€ avatar.png            # å® ç‰©å¤´åƒ
   â”‚   â”‚       â”œâ”€ chatbubble-bg.png     # å¯¹è¯æ°”æ³¡èƒŒæ™¯
   â”‚   â”‚       â”œâ”€ props.svg             # å® ç‰©é“å…·ï¼ˆé£æ‰‡ï¼‰
   â”‚   â”‚       â”œâ”€ vector-665.svg        # æŒ‰é’®å›¾æ ‡
   â”‚   â”‚       â””â”€ vector-*.svg          # è£…é¥°å‘é‡å›¾
   â”‚   â”œâ”€ manifest.json        # Chrome æ‰©å±•æ¸…å•
   â”‚   â”œâ”€ popup.html           # Popup é¡µé¢ï¼ˆå¤‡ç”¨ï¼‰
   â”‚   â””â”€ sidepanel.html       # Side Panel é¡µé¢ï¼ˆå¤‡ç”¨ï¼‰
   â”œâ”€ dist/                    # æ„å»ºè¾“å‡ºï¼ˆChrome æ‰©å±•ç›®å½•ï¼‰
   â”œâ”€ package.json
   â””â”€ vite.config.js
```

## å¿«é€Ÿå¼€å§‹

### åç«¯ï¼ˆFastAPIï¼‰

1. **å®‰è£… uv**ï¼ˆè‹¥å°šæœªåœ¨ PATHï¼‰ï¼š
   ```bash
   curl -LsSf https://astral.sh/uv/install.sh | sh
   source "$HOME/.local/bin/env"
   ```

2. **åŒæ­¥ä¾èµ–å¹¶åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**ï¼š
   ```bash
   cd backend/app
   uv sync
   ```

3. **å¯åŠ¨å¼€å‘æœåŠ¡å™¨**ï¼š
   ```bash
   # æ–¹å¼ä¸€ï¼ˆæ¨èï¼‰ï¼šä½¿ç”¨ uv è¿è¡Œ
   uv run uvicorn main:app --host 127.0.0.1 --port 8000 --reload

   # æ–¹å¼äºŒï¼šç›´æ¥ç”¨ venv å¯æ‰§è¡Œæ–‡ä»¶
   ./.venv/bin/uvicorn main:app --host 127.0.0.1 --port 8000 --reload
   ```

4. **è®¿é—®**ï¼š
   - å¥åº·æ£€æŸ¥: `http://127.0.0.1:8000/`ï¼ˆåº”è¿”å› `{ "ok": true }`ï¼‰
   - API æ–‡æ¡£: `http://127.0.0.1:8000/docs`

### å‰ç«¯ï¼ˆChrome æ‰©å±• - Shadow DOM + Viteï¼‰

#### å®ç°æ–¹å¼

æœ¬é¡¹ç›®ä½¿ç”¨ **Shadow DOM** æŠ€æœ¯å®ç°å¡ç‰‡ UIï¼Œè§£å†³äº† Chrome Popup æ— æ³•è®¾ç½®åœ†è§’çš„é—®é¢˜ï¼š

1. **ç‚¹å‡»æ’ä»¶å›¾æ ‡** â†’ `background.js` ç›‘å¬ç‚¹å‡»äº‹ä»¶
2. **æ³¨å…¥ Content Script** â†’ `content.js` è¢«æ³¨å…¥åˆ°å½“å‰ç½‘é¡µ
3. **åˆ›å»º Shadow DOM** â†’ åœ¨é¡µé¢ä¸­åˆ›å»ºéš”ç¦»çš„å¡ç‰‡å®¹å™¨
4. **åŠ è½½æ ·å¼å’Œæ¨¡æ¿** â†’ åŠ¨æ€åŠ è½½ CSS å’Œ HTML æ¨¡æ¿
5. **æ˜¾ç¤ºå¯æ‹–åŠ¨å¡ç‰‡** â†’ å¡ç‰‡å‡ºç°åœ¨å³ä¸Šè§’ï¼Œæ”¯æŒæ‹–åŠ¨

#### å¼€å‘æµç¨‹

1. **å®‰è£…ä¾èµ–**ï¼š
   ```bash
   cd frontend
   npm install
   ```

2. **å¼€å‘æ¨¡å¼**ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨æ„å»ºï¼‰ï¼š
   ```bash
   npm run dev
   ```
   > **æ³¨æ„**ï¼šå¼€å‘æ—¶å»ºè®®ç›´æ¥ä½¿ç”¨ `public/` ç›®å½•åŠ è½½æ‰©å±•ï¼Œä¿®æ”¹ååªéœ€"é‡æ–°åŠ è½½"æ‰©å±•ï¼Œæ— éœ€é‡æ–°æ„å»ºã€‚

3. **ç”Ÿäº§æ„å»º**ï¼š
   ```bash
   npm run build
   ```
   æ„å»ºè¾“å‡ºåœ¨ `dist/` ç›®å½•ã€‚

4. **åŠ è½½æ‰©å±•åˆ° Chrome**ï¼š
   - æ‰“å¼€ Chrome â†’ æ‰©å±•ç¨‹åº â†’ å¼€å‘è€…æ¨¡å¼
   - ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•"
   - é€‰æ‹© `frontend/public/` æˆ– `frontend/dist/` ç›®å½•
   - ä¿®æ”¹ `public/` ä¸­çš„ä»£ç åï¼Œç‚¹å‡»æ‰©å±•çš„"é‡æ–°åŠ è½½"æŒ‰é’®å³å¯ç”Ÿæ•ˆ

#### æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

- **`public/assets/background.js`**ï¼šService Workerï¼Œç›‘å¬æ’ä»¶å›¾æ ‡ç‚¹å‡»ï¼Œæ³¨å…¥ content script
- **`public/assets/content.js`**ï¼šContent Scriptï¼Œåˆ›å»º Shadow DOM å¹¶æ¸²æŸ“å¡ç‰‡
- **`public/assets/pet.js`**ï¼šå® ç‰©æ¨¡å—ï¼Œç‹¬ç«‹å¤„ç†æ¡Œé¢å® ç‰©åŠŸèƒ½ï¼ˆæ˜¾ç¤º/éšè—ã€æŒ‰é’®èœå•ï¼‰
- **`public/assets/card.html`**ï¼šå¡ç‰‡ HTML æ¨¡æ¿ï¼Œä½¿ç”¨ `{{PLACEHOLDER}}` å ä½ç¬¦
- **`public/assets/style.css`**ï¼šå¡ç‰‡æ ·å¼ï¼ŒåŒ…å«æŒ‰é’®å¸ƒå±€å’Œå®šä½
- **`public/manifest.json`**ï¼šæ‰©å±•æ¸…å•ï¼Œé…ç½®æƒé™å’Œèµ„æºè®¿é—®

## å‰åç«¯è”è°ƒ

- å‰ç«¯ API ç«¯ç‚¹ï¼š`http://localhost:8000/api/v1/...`
- å½“å‰åç«¯ä»…å®ç° `/` å¥åº·æ£€æŸ¥ï¼Œéœ€è¦è¡¥å……ä»¥ä¸‹è·¯ç”±ï¼š
  - `POST /api/v1/sessions` - åˆ›å»ºä¼šè¯
  - `POST /api/v1/tabs` - æ·»åŠ æ ‡ç­¾é¡µ
  - `POST /api/v1/share` - ç”Ÿæˆåˆ†äº«é“¾æ¥

## åç»­æ‰©å±•

### React Three Fiberï¼ˆ3D å¯è§†åŒ–ï¼‰

å¦‚éœ€åœ¨ sidepanel ä¸­ä½¿ç”¨ 3D æ¸²æŸ“ï¼š

```bash
cd frontend
npm install @react-three/fiber @react-three/drei three
```

ç„¶ååœ¨ `src/sidepanel/SidePanelApp.jsx` ä¸­ä½¿ç”¨ã€‚

## å¸¸è§é—®é¢˜

### åç«¯
- **æ— æ³•å¯¼å…¥ `fastapi`**ï¼šæœªæ‰§è¡Œ `uv sync` æˆ–æœªåœ¨é¡¹ç›®è™šæ‹Ÿç¯å¢ƒå†…è¿è¡Œ
- **é™æ€èµ„æºè·¯å¾„**ï¼šè‹¥å°†å…¥å£æ–‡ä»¶ç§»åŠ¨ä½ç½®ï¼Œæ³¨æ„æ›´æ–° `StaticFiles(directory=...)` çš„ç›¸å¯¹è·¯å¾„

### å‰ç«¯

#### æ‰©å±•åŠ è½½é—®é¢˜
- **æ‰©å±•åŠ è½½å¤±è´¥**ï¼š
  - ç¡®ä¿ `manifest.json` ä¸­æ‰€æœ‰æ–‡ä»¶è·¯å¾„æ­£ç¡®
  - æ£€æŸ¥ `web_accessible_resources` æ˜¯å¦åŒ…å«æ‰€éœ€èµ„æº
  - ä½¿ç”¨ `public/` ç›®å½•åŠ è½½æ—¶ï¼Œç¡®ä¿æ–‡ä»¶ç»“æ„å®Œæ•´

#### å¡ç‰‡æ˜¾ç¤ºé—®é¢˜
- **å¡ç‰‡ä¸æ˜¾ç¤º**ï¼š
  - æ£€æŸ¥ Console æ˜¯å¦æœ‰é”™è¯¯ï¼ˆ`chrome://extensions` â†’ æ‰©å±•è¯¦æƒ… â†’ Service workerï¼‰
  - ç¡®è®¤ `content.js` å·²æ­£ç¡®æ³¨å…¥ï¼ˆæ£€æŸ¥é¡µé¢ Consoleï¼‰
  - æŸäº›é¡µé¢ï¼ˆå¦‚ `chrome://`ã€PDFï¼‰æ— æ³•æ³¨å…¥ï¼Œè¿™æ˜¯æ­£å¸¸é™åˆ¶

- **èƒŒæ™¯å›¾ç‰‡ä¸æ˜¾ç¤º**ï¼š
  - ç¡®è®¤ `background-2.png` åœ¨ `static/img/` ç›®å½•ä¸­
  - æ£€æŸ¥ `web_accessible_resources` æ˜¯å¦åŒ…å« `static/img/*`
  - æŸ¥çœ‹ Console ä¸­å›¾ç‰‡åŠ è½½é”™è¯¯

- **æŒ‰é’®æ— æ³•ç‚¹å‡»**ï¼š
  - æ£€æŸ¥ `pointer-events` æ ·å¼æ˜¯å¦è¢«è¦†ç›–
  - ç¡®è®¤ `z-index` è®¾ç½®è¶³å¤Ÿé«˜
  - æŸ¥çœ‹æ˜¯å¦æœ‰å…¶ä»–å…ƒç´ é®æŒ¡æŒ‰é’®

#### å¼€å‘è°ƒè¯•
- **ä¿®æ”¹ä»£ç åä¸ç”Ÿæ•ˆ**ï¼š
  - å¦‚æœä½¿ç”¨ `public/` ç›®å½•ï¼šç‚¹å‡»æ‰©å±•çš„"é‡æ–°åŠ è½½"æŒ‰é’®
  - å¦‚æœä½¿ç”¨ `dist/` ç›®å½•ï¼šæ‰§è¡Œ `npm run build` åé‡æ–°åŠ è½½æ‰©å±•
  - åˆ·æ–°å½“å‰ç½‘é¡µæ ‡ç­¾é¡µ

- **è°ƒè¯• Content Script**ï¼š
  - åœ¨ç½‘é¡µä¸­å³é”® â†’ æ£€æŸ¥ â†’ Consoleï¼ˆä¸æ˜¯æ‰©å±•çš„ Service Worker Consoleï¼‰
  - æŸ¥çœ‹ `content.js` çš„æ—¥å¿—è¾“å‡º

- **è°ƒè¯• Service Worker**ï¼š
  - åœ¨ `chrome://extensions` â†’ æ‰©å±•è¯¦æƒ… â†’ Service workerï¼ˆInspect viewsï¼‰

## Git å·¥ä½œæµ

```bash
# åˆå§‹åŒ–ï¼ˆé¦–æ¬¡ï¼‰
git init
git add .
git commit -m "chore: initial commit"

# å…³è”è¿œç«¯å¹¶æ¨é€
git branch -M main
git remote add origin <YOUR_GITHUB_REPO_URL>
git push -u origin main
```

## æŠ€æœ¯æ ˆ

- **åç«¯**ï¼šFastAPI + Python 3.13+ + uv
- **å‰ç«¯**ï¼š
  - Chrome Extension Manifest V3
  - Shadow DOM APIï¼ˆå¡ç‰‡éš”ç¦»æ¸²æŸ“ï¼‰
  - Content Scriptï¼ˆé¡µé¢æ³¨å…¥ï¼‰
  - Service Workerï¼ˆåå°è„šæœ¬ï¼‰
  - Vite 6ï¼ˆæ„å»ºå·¥å…·ï¼‰
  - React 18ï¼ˆå‚è€ƒç»„ä»¶ï¼Œå½“å‰ä½¿ç”¨åŸç”Ÿ JSï¼‰
- **è®¾è®¡**ï¼šAnima ç”Ÿæˆç»„ä»¶

## å·¥ä½œåŸç†

### Shadow DOM å®ç°

1. **éš”ç¦»æ¸²æŸ“**ï¼šShadow DOM åˆ›å»ºå®Œå…¨éš”ç¦»çš„æ ·å¼å’Œä½œç”¨åŸŸï¼Œä¸å—é¡µé¢ CSS å½±å“
2. **åœ†è§’æ”¯æŒ**ï¼šåœ¨ Shadow DOM ä¸­å¯ä»¥è‡ªç”±è®¾ç½® `border-radius`ï¼Œä¸å— Chrome Popup é™åˆ¶
3. **èµ„æºè®¿é—®**ï¼šé€šè¿‡ `chrome.runtime.getURL()` è·å–æ‰©å±•èµ„æºè·¯å¾„
4. **åŠ¨æ€åŠ è½½**ï¼šCSS å’Œ HTML æ¨¡æ¿é€šè¿‡ `fetch` åŠ¨æ€åŠ è½½ï¼Œæ›¿æ¢å›¾ç‰‡è·¯å¾„å ä½ç¬¦

### æ¶ˆæ¯é€šä¿¡

- **Background â†’ Content**ï¼š`chrome.tabs.sendMessage()` å‘é€æ˜¾ç¤º/éšè—å‘½ä»¤
- **Content â†’ Background**ï¼š`chrome.runtime.sendMessage()` å‘é€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
- **è‡ªåŠ¨æ³¨å…¥**ï¼šå¦‚æœé¡µé¢åœ¨æ‰©å±•å®‰è£…å‰å·²æ‰“å¼€ï¼Œç‚¹å‡»å›¾æ ‡æ—¶ä¼šè‡ªåŠ¨æ³¨å…¥ content script

## å¼€å‘æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶è·¯å¾„ä¸€è‡´æ€§**ï¼šç¡®ä¿ `manifest.json`ã€`content.js`ã€`background.js` ä¸­çš„è·¯å¾„ä¸€è‡´
2. **èµ„æºå¯è®¿é—®æ€§**ï¼šæ‰€æœ‰éœ€è¦ä»é¡µé¢è®¿é—®çš„èµ„æºå¿…é¡»åœ¨ `web_accessible_resources` ä¸­å£°æ˜
3. **æ¨¡å—ç±»å‹**ï¼š`content.js` ä½¿ç”¨ IIFE æ ¼å¼ï¼Œç¡®ä¿å¯ä»¥é€šè¿‡ `executeScript` æ³¨å…¥
4. **æ ·å¼éš”ç¦»**ï¼šShadow DOM å†…çš„æ ·å¼ä¸ä¼šå½±å“é¡µé¢ï¼Œé¡µé¢çš„æ ·å¼ä¹Ÿä¸ä¼šå½±å“ Shadow DOM
